<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Ondas</title>
    <link rel="shortcut icon" href="assets/images/iconapp.png" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="assets/style.css">
</head>
<body class="body-waves">
    <div class="wrapper">
       <header>
        <nav>
            <ul>
                <li><a href="index.html">Generador de progresiones</a></li>
                <li><a href="Index2.html">Generador de partituras</a></li>
                <li><a href="#" class="active-nav-link">Generador de ondas</a></li>
                <li><a href="index4.html">CÃ­rculo de quintas</a></li>
                <li><a href="index5.html">Generador de cifrados</a></li>
            </ul>
        </nav>
    </header>
        <main>
            <!-- Piano 1 -->
            <div class="piano-wrapper" id="piano-1">
                <div class="waveform-buttons">
                    <button class="waveform-button" data-waveform="sine">Sine</button>
                    <button class="waveform-button" data-waveform="square">Square</button>
                    <button class="waveform-button" data-waveform="sawtooth">Sawtooth</button>
                    <button class="waveform-button" data-waveform="triangle">Triangle</button>
                </div>
                <div class="piano-container">
                    <svg class="piano-svg" viewBox="0 0 980 200">
                        <rect class="white-key" x="0" y="0" width="70" height="200" data-note="C4"/>
                        <rect class="white-key" x="70" y="0" width="70" height="200" data-note="D4"/>
                        <rect class="white-key" x="140" y="0" width="70" height="200" data-note="E4"/>
                        <rect class="white-key" x="210" y="0" width="70" height="200" data-note="F4"/>
                        <rect class="white-key" x="280" y="0" width="70" height="200" data-note="G4"/>
                        <rect class="white-key" x="350" y="0" width="70" height="200" data-note="A4"/>
                        <rect class="white-key" x="420" y="0" width="70" height="200" data-note="B4"/>
                        <rect class="white-key" x="490" y="0" width="70" height="200" data-note="C5"/>
                        <rect class="white-key" x="560" y="0" width="70" height="200" data-note="D5"/>
                        <rect class="white-key" x="630" y="0" width="70" height="200" data-note="E5"/>
                        <rect class="white-key" x="700" y="0" width="70" height="200" data-note="F5"/>
                        <rect class="white-key" x="770" y="0" width="70" height="200" data-note="G5"/>
                        <rect class="white-key" x="840" y="0" width="70" height="200" data-note="A5"/>
                        <rect class="white-key" x="910" y="0" width="70" height="200" data-note="B5"/>
                        <rect class="black-key" x="45" y="0" width="40" height="120" data-note="C#4"/>
                        <rect class="black-key" x="115" y="0" width="40" height="120" data-note="D#4"/>
                        <rect class="black-key" x="255" y="0" width="40" height="120" data-note="F#4"/>
                        <rect class="black-key" x="325" y="0" width="40" height="120" data-note="G#4"/>
                        <rect class="black-key" x="395" y="0" width="40" height="120" data-note="A#4"/>
                        <rect class="black-key" x="535" y="0" width="40" height="120" data-note="C#5"/>
                        <rect class="black-key" x="605" y="0" width="40" height="120" data-note="D#5"/>
                        <rect class="black-key" x="745" y="0" width="40" height="120" data-note="F#5"/>
                        <rect class="black-key" x="815" y="0" width="40" height="120" data-note="G#5"/>
                        <rect class="black-key" x="885" y="0" width="40" height="120" data-note="A#5"/>
                    </svg>
                </div>
            </div>

            <!-- Piano 2 -->
            <div class="piano-wrapper" id="piano-2">
                <div class="waveform-buttons">
                    <button class="waveform-button" data-waveform="sine">Sine</button>
                    <button class="waveform-button" data-waveform="square">Square</button>
                    <button class="waveform-button" data-waveform="sawtooth">Sawtooth</button>
                    <button class="waveform-button" data-waveform="triangle">Triangle</button>
                </div>
                <div class="piano-container">
                    <svg class="piano-svg" viewBox="0 0 980 200">
                        <rect class="white-key" x="0" y="0" width="70" height="200" data-note="C4"/>
                        <rect class="white-key" x="70" y="0" width="70" height="200" data-note="D4"/>
                        <rect class="white-key" x="140" y="0" width="70" height="200" data-note="E4"/>
                        <rect class="white-key" x="210" y="0" width="70" height="200" data-note="F4"/>
                        <rect class="white-key" x="280" y="0" width="70" height="200" data-note="G4"/>
                        <rect class="white-key" x="350" y="0" width="70" height="200" data-note="A4"/>
                        <rect class="white-key" x="420" y="0" width="70" height="200" data-note="B4"/>
                        <rect class="white-key" x="490" y="0" width="70" height="200" data-note="C5"/>
                        <rect class="white-key" x="560" y="0" width="70" height="200" data-note="D5"/>
                        <rect class="white-key" x="630" y="0" width="70" height="200" data-note="E5"/>
                        <rect class="white-key" x="700" y="0" width="70" height="200" data-note="F5"/>
                        <rect class="white-key" x="770" y="0" width="70" height="200" data-note="G5"/>
                        <rect class="white-key" x="840" y="0" width="70" height="200" data-note="A5"/>
                        <rect class="white-key" x="910" y="0" width="70" height="200" data-note="B5"/>
                        <rect class="black-key" x="45" y="0" width="40" height="120" data-note="C#4"/>
                        <rect class="black-key" x="115" y="0" width="40" height="120" data-note="D#4"/>
                        <rect class="black-key" x="255" y="0" width="40" height="120" data-note="F#4"/>
                        <rect class="black-key" x="325" y="0" width="40" height="120" data-note="G#4"/>
                        <rect class="black-key" x="395" y="0" width="40" height="120" data-note="A#4"/>
                        <rect class="black-key" x="535" y="0" width="40" height="120" data-note="C#5"/>
                        <rect class="black-key" x="605" y="0" width="40" height="120" data-note="D#5"/>
                        <rect class="black-key" x="745" y="0" width="40" height="120" data-note="F#5"/>
                        <rect class="black-key" x="815" y="0" width="40" height="120" data-note="G#5"/>
                        <rect class="black-key" x="885" y="0" width="40" height="120" data-note="A#5"/>
                    </svg>
                </div>
            </div>

            <!-- Piano 3 -->
            <div class="piano-wrapper" id="piano-3">
                <div class="waveform-buttons">
                    <button class="waveform-button" data-waveform="sine">Sine</button>
                    <button class="waveform-button" data-waveform="square">Square</button>
                    <button class="waveform-button" data-waveform="sawtooth">Sawtooth</button>
                    <button class="waveform-button" data-waveform="triangle">Triangle</button>
                </div>
                <div class="piano-container">
                    <svg class="piano-svg" viewBox="0 0 980 200">
                        <rect class="white-key" x="0" y="0" width="70" height="200" data-note="C4"/>
                        <rect class="white-key" x="70" y="0" width="70" height="200" data-note="D4"/>
                        <rect class="white-key" x="140" y="0" width="70" height="200" data-note="E4"/>
                        <rect class="white-key" x="210" y="0" width="70" height="200" data-note="F4"/>
                        <rect class="white-key" x="280" y="0" width="70" height="200" data-note="G4"/>
                        <rect class="white-key" x="350" y="0" width="70" height="200" data-note="A4"/>
                        <rect class="white-key" x="420" y="0" width="70" height="200" data-note="B4"/>
                        <rect class="white-key" x="490" y="0" width="70" height="200" data-note="C5"/>
                        <rect class="white-key" x="560" y="0" width="70" height="200" data-note="D5"/>
                        <rect class="white-key" x="630" y="0" width="70" height="200" data-note="E5"/>
                        <rect class="white-key" x="700" y="0" width="70" height="200" data-note="F5"/>
                        <rect class="white-key" x="770" y="0" width="70" height="200" data-note="G5"/>
                        <rect class="white-key" x="840" y="0" width="70" height="200" data-note="A5"/>
                        <rect class="white-key" x="910" y="0" width="70" height="200" data-note="B5"/>
                        <rect class="black-key" x="45" y="0" width="40" height="120" data-note="C#4"/>
                        <rect class="black-key" x="115" y="0" width="40" height="120" data-note="D#4"/>
                        <rect class="black-key" x="255" y="0" width="40" height="120" data-note="F#4"/>
                        <rect class="black-key" x="325" y="0" width="40" height="120" data-note="G#4"/>
                        <rect class="black-key" x="395" y="0" width="40" height="120" data-note="A#4"/>
                        <rect class="black-key" x="535" y="0" width="40" height="120" data-note="C#5"/>
                        <rect class="black-key" x="605" y="0" width="40" height="120" data-note="D#5"/>
                        <rect class="black-key" x="745" y="0" width="40" height="120" data-note="F#5"/>
                        <rect class="black-key" x="815" y="0" width="40" height="120" data-note="G#5"/>
                        <rect class="black-key" x="885" y="0" width="40" height="120" data-note="A#5"/>
                    </svg>
                </div>
            </div>

            <!-- Piano 4 -->
            <div class="piano-wrapper" id="piano-4">
                <div class="waveform-buttons">
                    <button class="waveform-button" data-waveform="sine">Sine</button>
                    <button class="waveform-button" data-waveform="square">Square</button>
                    <button class="waveform-button" data-waveform="sawtooth">Sawtooth</button>
                    <button class="waveform-button" data-waveform="triangle">Triangle</button>
                </div>
                <div class="piano-container">
                    <svg class="piano-svg" viewBox="0 0 980 200">
                        <rect class="white-key" x="0" y="0" width="70" height="200" data-note="C4"/>
                        <rect class="white-key" x="70" y="0" width="70" height="200" data-note="D4"/>
                        <rect class="white-key" x="140" y="0" width="70" height="200" data-note="E4"/>
                        <rect class="white-key" x="210" y="0" width="70" height="200" data-note="F4"/>
                        <rect class="white-key" x="280" y="0" width="70" height="200" data-note="G4"/>
                        <rect class="white-key" x="350" y="0" width="70" height="200" data-note="A4"/>
                        <rect class="white-key" x="420" y="0" width="70" height="200" data-note="B4"/>
                        <rect class="white-key" x="490" y="0" width="70" height="200" data-note="C5"/>
                        <rect class="white-key" x="560" y="0" width="70" height="200" data-note="D5"/>
                        <rect class="white-key" x="630" y="0" width="70" height="200" data-note="E5"/>
                        <rect class="white-key" x="700" y="0" width="70" height="200" data-note="F5"/>
                        <rect class="white-key" x="770" y="0" width="70" height="200" data-note="G5"/>
                        <rect class="white-key" x="840" y="0" width="70" height="200" data-note="A5"/>
                        <rect class="white-key" x="910" y="0" width="70" height="200" data-note="B5"/>
                        <rect class="black-key" x="45" y="0" width="40" height="120" data-note="C#4"/>
                        <rect class="black-key" x="115" y="0" width="40" height="120" data-note="D#4"/>
                        <rect class="black-key" x="255" y="0" width="40" height="120" data-note="F#4"/>
                        <rect class="black-key" x="325" y="0" width="40" height="120" data-note="G#4"/>
                        <rect class="black-key" x="395" y="0" width="40" height="120" data-note="A#4"/>
                        <rect class="black-key" x="535" y="0" width="40" height="120" data-note="C#5"/>
                        <rect class="black-key" x="605" y="0" width="40" height="120" data-note="D#5"/>
                        <rect class="black-key" x="745" y="0" width="40" height="120" data-note="F#5"/>
                        <rect class="black-key" x="815" y="0" width="40" height="120" data-note="G#5"/>
                        <rect class="black-key" x="885" y="0" width="40" height="120" data-note="A#5"/>
                    </svg>
                </div>
            </div>
        </main>
    </div>
    <footer>
        <p> </p>
    </footer>
    <script src="https://unpkg.com/tone@14.7.58/build/Tone.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const createPianoInstance = (pianoWrapper) => {
                let activeNote = {
                    noteName: null,
                    synth: null
                };
                let currentWaveform = 'sine'; // Default waveform

                // Waveform button logic
                const waveformButtons = pianoWrapper.querySelectorAll('.waveform-button');
                waveformButtons.forEach(button => {
                    // Set initial active button
                    if (button.dataset.waveform === currentWaveform) {
                        button.classList.add('active');
                    }

                    button.addEventListener('click', () => {
                        currentWaveform = button.dataset.waveform;
                        // Update active class
                        waveformButtons.forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        
                        // If a note is already playing, restart it with the new waveform
                        if (activeNote.noteName) {
                            const playingNote = activeNote.noteName;
                            stopDrone();
                            startDrone(playingNote);
                        }
                    });
                });

                const startDrone = (noteName) => {
                    if (activeNote.synth) {
                        stopDrone();
                    }

                    activeNote.noteName = noteName;
                    activeNote.synth = new Tone.Synth({
                        oscillator: { type: currentWaveform }, // Use the selected waveform
                        envelope: { attack: 0.5, decay: 0.1, sustain: 1.0, release: 1.0 }
                    }).toDestination();

                    const volumeControl = pianoWrapper.querySelector('.piano-volume');
                    activeNote.synth.volume.value = volumeControl.value;

                    activeNote.synth.triggerAttack(noteName);

                    if (Tone.Transport.state !== 'started') {
                        Tone.Transport.start();
                    }

                    pianoWrapper.querySelector(`[data-note="${noteName}"]`).classList.add('active');
                };

                const stopDrone = () => {
                    if (activeNote.synth) {
                        const noteToDeactivate = activeNote.noteName;
                        activeNote.synth.triggerRelease();
                        activeNote.synth.dispose();
                        
                        const activeButton = pianoWrapper.querySelector(`[data-note="${noteToDeactivate}"]`);
                        if(activeButton) activeButton.classList.remove('active');

                        activeNote.noteName = null;
                        activeNote.synth = null;
                    }
                };

                const noteButtons = pianoWrapper.querySelectorAll('rect[data-note]');
                noteButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const noteName = button.getAttribute('data-note');
                        if (activeNote.noteName === noteName) {
                            stopDrone();
                        } else {
                            startDrone(noteName);
                        }
                    });
                });

                const pianoVolumeControl = document.createElement('input');
                pianoVolumeControl.type = 'range';
                pianoVolumeControl.className = 'piano-volume';
                pianoVolumeControl.min = '-30';
                pianoVolumeControl.max = '0';
                pianoVolumeControl.value = '-6';
                pianoVolumeControl.addEventListener('input', (event) => {
                    if(activeNote.synth) activeNote.synth.volume.value = event.target.value;
                });

                const volumeContainer = document.createElement('div');
                volumeContainer.className = 'volume-control-container';

                const volumeLabel = document.createElement('label');
                volumeLabel.innerText = 'Volumen';

                volumeContainer.appendChild(volumeLabel);
                volumeContainer.appendChild(pianoVolumeControl);

                const pianoContainer = pianoWrapper.querySelector('.piano-container');
                pianoWrapper.insertBefore(volumeContainer, pianoContainer);
            };

            document.querySelectorAll('.piano-wrapper').forEach(createPianoInstance);
        });
    </script>
</body>
</html>